import{addMusic,getMusic,newMusic,deleteMusic}from"./firebase/client.js";import{getDownloadURL}from"https://www.gstatic.com/firebasejs/9.9.3/firebase-storage.js";const toggleViewButton=document.querySelector(".toggleView");let noWelcome=JSON.parse(localStorage.getItem("noWelcome"))||!1,welcomeContent=localStorage.getItem("welcomeContent")||!1,themeList=JSON.parse(localStorage.getItem("themeList"))||!1;if(!noWelcome){document.querySelector(".container1 .tabs").insertAdjacentHTML("afterbegin",'\n        <div id="40be4e59b9a2a2b5dffb918c0e86b3d7"\n        class="welcomeTab active" title="Welcome to reverb!">\n            <div class="icon">\n                <i class="far fa-file"></i>\n            </div>\n            <div class="title">\n                Welcome to reverb!\n            </div>\n            <div class="close">\n                <i class="fas fa-times"></i>\n            </div>\n        </div>\n    '),document.querySelector(".tabs .welcomeTab").addEventListener("click",(()=>{textarea.value=welcomeContent,previewText(textarea.value),document.querySelector(".tabs .active").classList.remove("active"),document.querySelector(".tabs .welcomeTab").classList.add("active")})),document.querySelector(".tabs .welcomeTab .close").addEventListener("click",(e=>e.stopPropagation()))}const textarea=document.querySelector(".document .textarea"),preview=document.querySelector(".preview"),toggleViewIcon=document.querySelector(".toggleView i"),rDocument=document.querySelector(".document"),homeButton=document.querySelector(".home"),viewFiles=document.querySelector(".files"),addNoteButton=document.querySelector(".sidebar .add"),addNoteInput=document.querySelector(".sidebar .add .newNote"),addNoteClose=document.querySelector(".sidebar .add .newNote .close"),addNoteSave=document.querySelector(".sidebar .add .newNote input"),folder=document.querySelector(".folder"),folderList=document.querySelector(".folder .list"),closeWelcome=document.querySelector(".container1 .tabs .close"),newNote=document.querySelector(".folder .newNote"),addNoteTab=document.querySelector("header .addTab"),addGuideNote=document.querySelector(".guide .addNote"),musicButton=document.querySelector(".sidebar .music"),musicPlayer=document.querySelector(".musicPlayer"),floatingPlayer=document.querySelector(".floatingPlayer"),closeFloating=document.querySelector(".floatingPlayer .close"),disc=document.querySelector(".musicPlayer .fa-compact-disc"),disc2=document.querySelector(".floatingPlayer .fa-compact-disc"),themeName=document.querySelector(".musicPlayer .themeName"),themeName2=document.querySelector(".floatingPlayer .themeName span"),playButton=document.querySelector(".musicPlayer .play"),playButton2=document.querySelector(".floatingPlayer .play"),prevButton=document.querySelector(".musicPlayer .prev"),prevButton2=document.querySelector(".floatingPlayer .prev"),nextButton=document.querySelector(".musicPlayer .next"),nextButton2=document.querySelector(".floatingPlayer .next"),musicList=document.querySelector(".musicPlayer .musicList .list"),musicQuantity=document.querySelector(".musicPlayer .quantity"),uploadTrack=document.querySelector(".musicPlayer .uploadTrack"),uploadTrackInput=document.querySelector(".musicPlayer input"),volumeIndicator=document.querySelector(".volumeIndicator"),configButton=document.querySelector(".config"),configContainer=document.querySelector(".configContainer"),configModal=configContainer.querySelector(".configModal"),configOptions=configModal.querySelectorAll(".op"),previewFirst=configModal.querySelector(".general #previewFirst"),fontSelect=configModal.querySelector(".font .option select"),fontOptions=fontSelect.querySelectorAll("option"),showFloatingToggle=configModal.querySelector(".music #showFloating"),floatingPosition=configModal.querySelector(".music #floatingPosition");let volTimer;const uid=localStorage.getItem("uid")||(localStorage.setItem("uid",Date.now()),localStorage.getItem("uid")),checkNotes=()=>{const e=document.querySelector(".container1 .tabs"),t=JSON.parse(localStorage.getItem("notes"))||(localStorage.setItem("notes",JSON.stringify([])),[]),a=localStorage.getItem("openNotes")?JSON.parse(localStorage.getItem("openNotes")):(localStorage.setItem("openNotes",JSON.stringify([])),[]);if(t.length)folderList.classList.remove("empty"),document.querySelector(".folder .noNotes")&&document.querySelector(".folder .noNotes").remove(),folderList.innerHTML="",t.map((({title:e})=>{folderList.insertAdjacentHTML("beforeend",`<div class="item" title="${e}">\n                    <i class="fas fa-note-sticky"></i>\n                    <span>\n                        ${e}\n                    </span>\n                    <div class="delete">\n                        <i class="fas fa-trash"></i>\n                    </div>\n                </div>`),document.querySelector(`.folder .list .item[title="${e}"]`).addEventListener("click",(()=>addTab(e))),document.querySelector(`.folder .list .item[title="${e}"] .delete`).addEventListener("click",(t=>{t.stopPropagation(),confirmDelete(e)}))})),a.map((({title:t})=>{document.querySelector(`.tabs .tab[title="${t}"]`)||(e.insertAdjacentHTML("beforeend",`<div id="${t}"\n                    class="tab" title="${t}">\n                        <div class="icon">\n                            <i class="far fa-file"></i>\n                        </div>\n                        <div class="title">\n                            ${t}\n                        </div>\n                        <div title=${t} class="close">\n                            <i class="fas fa-times"></i>\n                        </div>\n                    </div>`),document.querySelector(`.tabs .tab[title="${t}"] .close`).addEventListener("click",(e=>{e.stopPropagation(),closeTab(t)})),document.querySelector(`.tabs .tab[title="${t}"]`).addEventListener("click",(()=>changeTab(t))))}));else{const e=folderList.lastElementChild;e&&folderList.children.length&&folderList.removeChild(e),folderList.classList.add("empty"),folderList.insertAdjacentHTML("afterend",'<div class="noNotes">\n                <i class="fas fa-file-circle-xmark"></i>\n                <span>You don\'t have any notes yet!</span>\n            </div>')}};checkNotes();const checkTabs=()=>{const e=document.querySelector(".container1 .tabs"),t=JSON.parse(localStorage.getItem("notes")),a=document.querySelectorAll(".tabs .tab"),o=JSON.parse(localStorage.getItem("openNotes")),c=document.querySelector(".guide");document.querySelector(".tabs .creating")||(a.forEach((({id:e})=>{if(!t.find((t=>t.title==e))&&(document.querySelector(`.tabs .tab[title="${e}"]`).remove(),o.find((t=>t.title==e)))){const t=o.findIndex((t=>t.title==e));o.splice(t,1),localStorage.setItem("openNotes",JSON.stringify(o))}})),e.children.length?(toggleViewButton.classList.remove("hidden"),document.querySelector("header").classList.contains("noTabs")&&document.querySelector("header").classList.remove("noTabs"),c.classList.contains("active")&&c.classList.remove("active")):(document.querySelector("header").classList.add("noTabs"),c.classList.add("active"),toggleViewIcon.classList.contains("fa-floppy-disk")&&toggleViewButton.click(),toggleViewButton.classList.add("hidden")))};checkTabs();const addTab=e=>{const t=document.querySelector(".container1 .tabs");if(document.querySelector(`.tabs .tab[title="${e}"]`))return;t.insertAdjacentHTML("beforeend",`<div id="${e}"\n        class="tab" title="${e}">\n            <div class="icon">\n                <i class="far fa-file"></i>\n            </div>\n            <div class="title">\n                ${e}\n            </div>\n            <div class="close">\n                <i class="fas fa-times"></i>\n            </div>\n        </div>`),document.querySelector(`.tabs .tab[title="${e}"] .close`).addEventListener("click",(t=>{t.stopPropagation(),closeTab(e)})),document.querySelector(`.tabs .tab[title="${e}"]`).addEventListener("click",(()=>changeTab(e)));const a=JSON.parse(localStorage.getItem("openNotes")),o={title:e,active:!0};a.push(o),localStorage.setItem("openNotes",JSON.stringify(a)),changeTab(e),toggleViewIcon.classList.contains("fa-pen")&&toggleView(),checkTabs()},closeTab=e=>{const t=document.querySelector(`.tabs .tab.active[title="${e}"]`),a=JSON.parse(localStorage.getItem("openNotes")),o=a.findIndex((t=>t.title==e)),c=a[o+1]?a.slice(o+1):a.slice(o-1),i=document.querySelectorAll(".tabs .tab").length;1!=i||noWelcome?t&&(changeTab(c[0].title),1==i&&(textarea.value="",previewText(textarea.value))):(textarea.value=welcomeContent,previewText(textarea.value),document.querySelector(".tabs .welcomeTab").classList.add("active")),document.querySelector(`.tabs .tab[title="${e}"]`).remove();const n=a.findIndex((t=>t.title==e)),s=JSON.parse(localStorage.getItem("openNotes"));s.splice(n,1),localStorage.setItem("openNotes",JSON.stringify(s)),checkTabs()},changeTab=e=>{const t=JSON.parse(localStorage.getItem("notes")),a=t.findIndex((t=>t.title==e)),o=JSON.parse(localStorage.getItem("openNotes")).map((t=>t.title==e?{...t,active:!0}:{...t,active:!1}));localStorage.setItem("openNotes",JSON.stringify(o)),textarea.value=t[a].content,previewText(t[a].content),document.querySelector(".tabs .active")&&document.querySelector(".tabs .active").classList.remove("active"),document.querySelector(`.tabs .tab[title="${e}"]`).classList.add("active")},deleteFile=e=>{const t=document.querySelector(`.tabs .tab.active[title="${e}"]`),a=JSON.parse(localStorage.getItem("openNotes")),o=a.findIndex((t=>t.title==e)),c=JSON.parse(localStorage.getItem("notes")),i=c.findIndex((t=>t.title==e)),n=a[o+1]?a.slice(o+1):a.slice(o-1),s=document.querySelectorAll(".tabs .tab").length;1!=s||noWelcome?t&&(changeTab(n[0].title),1==s&&(textarea.value="",previewText(textarea.value))):(textarea.value=welcomeContent,previewText(textarea.value),document.querySelector(".tabs .welcomeTab").classList.add("active")),c.splice(i,1),localStorage.setItem("notes",JSON.stringify(c)),checkNotes(),checkTabs()},confirmDelete=e=>{document.querySelector(".mainContainer").insertAdjacentHTML("afterbegin",'<div class="confirmDelete">\n            <div class="modal">\n                <div class="content">\n                    <i class="fas fa-triangle-exclamation"></i>\n                    <p>Are you sure to delete this file?</p>\n                </div>\n                <div class="buttons">\n                    <button class="yes">Yes</button>\n                    <button class="no">No</button>\n                </div>\n            </div>\n        </div>');const t=document.querySelector(".confirmDelete");t.addEventListener("click",(()=>{t.remove()})),document.querySelector(".confirmDelete .modal").addEventListener("click",(e=>e.stopPropagation())),document.querySelector(".confirmDelete .yes").addEventListener("click",(()=>{deleteFile(e),t.remove()})),document.querySelector(".confirmDelete .no").addEventListener("click",(()=>{t.remove()}))},saveDocument=e=>{e.ctrlKey&&83==e.keyCode?e.preventDefault():27==e.keyCode&&closeMenu()},markdownParser=e=>{let t=e;return keyWords.map((({rule:e,parse:a})=>{t=t.replace(e,a)})),keyWords2.map((({rule:e,parse:a})=>{t=t.replace(e,a)})),t.trim()},previewText=e=>{const t=markdownParser(e);preview.innerHTML=t},toggleView=()=>{rDocument.classList.contains("active")?(toggleViewIcon.classList.remove("fa-floppy-disk"),toggleViewIcon.classList.add("fa-pen")):(toggleViewIcon.classList.remove("fa-pen"),toggleViewIcon.classList.add("fa-floppy-disk")),rDocument.classList.toggle("active"),textarea.focus()},toggleFloating=()=>{floatingPlayer.classList.toggle("active")},togglePlay=()=>{const e=document.querySelector("audio");e.src&&(document.querySelector(".musicPlayer .controls").classList.contains("active")?(document.querySelector(".musicPlayer .play i").classList.add("fa-play"),document.querySelector(".musicPlayer .play i").classList.remove("fa-pause"),document.querySelector(".floatingPlayer .play i").classList.add("fa-play"),document.querySelector(".floatingPlayer .play i").classList.remove("fa-pause"),disc.style.animationPlayState="paused",disc2.style.animationPlayState="paused",e.src&&e.pause()):(document.querySelector(".musicPlayer .play i").classList.remove("fa-play"),document.querySelector(".musicPlayer .play i").classList.add("fa-pause"),document.querySelector(".floatingPlayer .play i").classList.remove("fa-play"),document.querySelector(".floatingPlayer .play i").classList.add("fa-pause"),disc.style.animationPlayState="running",disc2.style.animationPlayState="running",e.src&&e.play()),document.querySelector(".musicPlayer .controls").classList.toggle("active"))},prevSong=()=>{const e=document.querySelector("audio");if(!e.src)return;const t=JSON.parse(localStorage.getItem("music"))||[],a=t.findIndex((e=>1==e.playing));if(0==a){if(1!=t.length){const a=t.map((e=>1==e.playing?{...e,playing:!1}:e.id==t[t.length-1].id?{...e,playing:!0}:e));localStorage.setItem("music",JSON.stringify(a)),e.src=t[t.length-1].url,themeName.innerHTML=t[t.length-1].title,themeName2.innerHTML=t[t.length-1].title}else localStorage.setItem("music",JSON.stringify(t)),e.src=t[0].url;document.querySelector(".musicPlayer .controls").classList.contains("active")?e.play():(document.querySelector(".musicPlayer .play i").classList.remove("fa-play"),document.querySelector(".musicPlayer .play i").classList.add("fa-pause"),document.querySelector(".floatingPlayer .play i").classList.remove("fa-play"),document.querySelector(".floatingPlayer .play i").classList.add("fa-pause"),disc.style.animationPlayState="running",disc2.style.animationPlayState="running",e.src&&e.play(),document.querySelector(".musicPlayer .controls").classList.add("active"))}else{const o=t.map((e=>1==e.playing?{...e,playing:!1}:e.id==t[a-1].id?{...e,playing:!0}:e));localStorage.setItem("music",JSON.stringify(o)),e.src=t[a-1].url,themeName.innerHTML=t[a-1].title,themeName2.innerHTML=t[a-1].title,document.querySelector(".musicPlayer .controls").classList.contains("active")?e.play():(document.querySelector(".musicPlayer .play i").classList.remove("fa-play"),document.querySelector(".musicPlayer .play i").classList.add("fa-pause"),document.querySelector(".floatingPlayer .play i").classList.remove("fa-play"),document.querySelector(".floatingPlayer .play i").classList.add("fa-pause"),disc.style.animationPlayState="running",disc2.style.animationPlayState="running",e.src&&e.play(),document.querySelector(".musicPlayer .controls").classList.add("active"))}},nextSong=()=>{const e=document.querySelector("audio");if(!e.src)return;const t=JSON.parse(localStorage.getItem("music"))||[],a=t.findIndex((e=>1==e.playing));if(a==t.length-1){const a=t.map((e=>1==e.playing?{...e,playing:!1}:e.id==t[0].id?{...e,playing:!0}:e));localStorage.setItem("music",JSON.stringify(a)),e.src=t[0].url,themeName.innerHTML=t[0].title,themeName2.innerHTML=t[0].title,document.querySelector(".musicPlayer .controls").classList.contains("active")?e.play():(document.querySelector(".musicPlayer .play i").classList.remove("fa-play"),document.querySelector(".musicPlayer .play i").classList.add("fa-pause"),document.querySelector(".floatingPlayer .play i").classList.remove("fa-play"),document.querySelector(".floatingPlayer .play i").classList.add("fa-pause"),disc.style.animationPlayState="running",disc2.style.animationPlayState="running",e.src&&e.play(),document.querySelector(".musicPlayer .controls").classList.add("active"))}else{const o=t.map((e=>1==e.playing?{...e,playing:!1}:e.id==t[a+1].id?{...e,playing:!0}:e));localStorage.setItem("music",JSON.stringify(o)),e.src=t[a+1].url,themeName.innerHTML=t[a+1].title,themeName2.innerHTML=t[a+1].title,document.querySelector(".musicPlayer .controls").classList.contains("active")?e.play():(document.querySelector(".musicPlayer .play i").classList.remove("fa-play"),document.querySelector(".musicPlayer .play i").classList.add("fa-pause"),document.querySelector(".floatingPlayer .play i").classList.remove("fa-play"),document.querySelector(".floatingPlayer .play i").classList.add("fa-pause"),disc.style.animationPlayState="running",disc2.style.animationPlayState="running",e.src&&e.play(),document.querySelector(".musicPlayer .controls").classList.add("active"))}},viewMusic=()=>{folder.classList.contains("active")&&viewFolder(),addNoteButton.classList.contains("active")||(musicPlayer.classList.contains("active")?volumeIndicator.classList.remove("menuOpen"):(volumeIndicator.classList.add("menuOpen"),document.querySelector(".container1").classList.add("menuOpen")),toggleFloating(),musicPlayer.classList.toggle("active"))},hideFloating=()=>{localStorage.setItem("hiddenFloating",!0),floatingPlayer.style.display="none",showFloatingToggle.checked=!1},checkFloating=()=>{const e=JSON.parse(localStorage.getItem("hiddenFloating"))||!1,t={tl:{top:"5em",right:"initial",bottom:"initial",left:"6em"},tm:{top:"5em",right:"initial",bottom:"initial",left:"calc(50vw - 11em)"},tr:{top:"5em",right:"3em",bottom:"initial",left:"initial"},rm:{top:"calc(50vh - 5em)",right:"3em",bottom:"initial",left:"initial"},br:{top:"initial",right:"3em",bottom:"5em",left:"initial"},bm:{top:"initial",right:"calc(50vw - 11em)",bottom:"5em",left:"initial"},bl:{top:"initial",right:"initial",bottom:"5em",left:"6em"},lm:{top:"initial",right:"initial",bottom:"calc(50vh - 5em)",left:"6em"}}[localStorage.getItem("floatingPosition")||"br"];floatingPlayer.style.display=e?"none":"flex",floatingPlayer.style.top=t.top,floatingPlayer.style.right=t.right,floatingPlayer.style.bottom=t.bottom,floatingPlayer.style.left=t.left};checkFloating();const playTrack=e=>{const t=JSON.parse(localStorage.getItem("music")),a=t.find((e=>1==e.playing)),o=t.find((t=>t.id==e));if(a)if(a.id==o.id){const e=t.map((e=>a.id==e.id?{...e,playing:!0}:{...e,playing:!1}));localStorage.setItem("music",JSON.stringify(e))}else{const e=t.map((e=>o.id==e.id?{...e,playing:!0}:{...e,playing:!1}));localStorage.setItem("music",JSON.stringify(e))}else{const a=t.map((t=>t.id==e?{...t,playing:!0}:t));localStorage.setItem("music",JSON.stringify(a))}const c=document.querySelector("audio");c.src=o.url,themeName.innerHTML=o.title,themeName2.innerHTML=o.title,c.play(),document.querySelector(".musicPlayer .controls").classList.contains("active")||(document.querySelector(".musicPlayer .play i").classList.remove("fa-play"),document.querySelector(".musicPlayer .play i").classList.add("fa-pause"),document.querySelector(".floatingPlayer .play i").classList.remove("fa-play"),document.querySelector(".floatingPlayer .play i").classList.add("fa-pause"),disc.style.animationPlayState="running",disc2.style.animationPlayState="running",document.querySelector(".musicPlayer .controls").classList.add("active"))},changeDiscVol=e=>{const t=document.querySelector("audio");e.deltaY<0?t.volume=1!=t.volume?Math.round(100*(t.volume+.01))/100:1:t.volume=0!=t.volume?Math.round(100*(t.volume-.01))/100:0,showVolume()},showVolume=()=>{const e=document.querySelector("audio").volume,t=volumeIndicator.querySelector("i");!volumeIndicator.classList.contains("active")&&volumeIndicator.classList.add("active"),window.innerWidth<=700?(volumeIndicator.querySelector(".progress").style.width&&volumeIndicator.querySelector(".progress").removeAttribute("style"),volumeIndicator.querySelector(".progress").style.height=100*e+"%"):(volumeIndicator.querySelector(".progress").style.height&&volumeIndicator.querySelector(".progress").removeAttribute("style"),volumeIndicator.querySelector(".progress").style.width=100*e+"%"),100*e==0?(t.removeAttribute("class"),t.setAttribute("class","fas fa-volume-xmark")):100*e>0&&100*e<50?(t.removeAttribute("class"),t.setAttribute("class","fas fa-volume-low")):100*e>=50&&(t.removeAttribute("class"),t.setAttribute("class","fas fa-volume-high")),clearTimeout(volTimer),volTimer=setTimeout((()=>{volumeIndicator.classList.remove("active")}),1e3)},listMusic=()=>{const e=JSON.parse(localStorage.getItem("music"))||[],t=document.querySelector("audio");if(musicList.innerHTML="",musicList.classList.remove("empty"),musicQuantity.classList.remove("empty"),musicList.insertAdjacentHTML("afterbegin",'<div class="spinnerContainer">\n            <div class="spinnerWrapper">\n                <div class="spinner"></div>\n            </div>\n        </div>'),musicQuantity.innerHTML=`${e.length} of 20`,!e.length)return musicList.insertAdjacentHTML("beforeend",'<div class="noTracks">\n                <i class="fas fa-heart-circle-xmark"></i>\n                <span>You don\'t have music yet!</span>\n            </div>'),musicList.classList.add("empty"),musicQuantity.classList.add("empty"),t.removeAttribute("src"),themeName.innerHTML="No tracks to play",themeName2.innerHTML="No tracks to play",void(!floatingPlayer.classList.contains("hidden")&&floatingPlayer.classList.add("hidden"));let a=1;e.forEach((({id:o,title:c,url:i})=>{if(1==a){const a=e.find((e=>1==e.playing));if(!document.querySelector(".musicPlayer .controls").classList.contains("active")&&(t.volume=.1),a)document.querySelector(".musicPlayer .controls").classList.contains("active")?playTrack(a.id):(t.src=a.url,themeName.innerHTML=a.title,themeName2.innerHTML=a.title);else{const a=e.map((e=>e.id==o?{...e,playing:!0}:e));localStorage.setItem("music",JSON.stringify(a)),t.src=i,themeName.innerHTML=c,themeName2.innerHTML=c,document.querySelector(".musicPlayer .controls").classList.contains("active")&&togglePlay()}}musicList.insertAdjacentHTML("beforeend",`<div class="item" title=${c} id=${o}>\n                <div class="trackInfo">\n                    <span class="trackNumber">${a}.</span>\n                    <span class="trackTitle">${c}</span>\n                </div>\n                <div class="delete" title="${o}">\n                    <i class="fas fa-trash"></i>\n                </div>\n            </div>`),document.querySelector(`.musicList .list .item[id="${o}"]`).addEventListener("click",(()=>playTrack(o))),document.querySelector(`.item .delete[title="${o}"]`).addEventListener("click",(e=>{e.stopPropagation(),confirmDeleteTrack(o)})),a++})),floatingPlayer.classList.contains("hidden")&&floatingPlayer.classList.remove("hidden")};listMusic();const deleteTrack=e=>{const t=document.querySelector(".musicPlayer .list .spinnerContainer"),a=JSON.parse(localStorage.getItem("music"));uploadTrack.setAttribute("disabled",""),t.classList.add("active"),deleteMusic(e).then((()=>{const o=a.find((e=>1==e.playing));getMusic(uid).then((a=>{const c=a.map((t=>o.id==t.id?o.id!=e&&{...t,playing:!0}:{...t,playing:!1}));localStorage.setItem("music",JSON.stringify(c)),uploadTrack.removeAttribute("disabled"),t.classList.remove("active"),listMusic()}))}))},confirmDeleteTrack=e=>{document.querySelector(".mainContainer").insertAdjacentHTML("afterbegin",'<div class="confirmDelete">\n            <div class="modal">\n                <div class="content">\n                    <i class="fas fa-triangle-exclamation"></i>\n                    <p>Are you sure to delete this track?</p>\n                </div>\n                <div class="buttons">\n                    <button class="yes">Yes</button>\n                    <button class="no">No</button>\n                </div>\n            </div>\n        </div>');const t=document.querySelector(".confirmDelete");t.addEventListener("click",(()=>{t.remove()})),t.querySelector(".modal").addEventListener("click",(e=>e.stopPropagation())),t.querySelector(".yes").addEventListener("click",(()=>{t.remove(),deleteTrack(e)})),t.querySelector(".no").addEventListener("click",(()=>{t.remove()}))},processTrack=e=>{const t=document.querySelector(".musicPlayer .list .spinnerContainer"),a=JSON.parse(localStorage.getItem("music"))||[];if(20==a.length)return;const o=e.target.files[0],c=o.name.split(".").pop(),i=o.name.split(`.${c}`).shift(),n=Number((o.size/1048576).toFixed(2)),s=o.type.match("audio.*");if(n>5)return;if(!s)return;const l=addMusic(o,c);l.on("state_changed",(()=>{uploadTrack.setAttribute("disabled",""),t.classList.add("active")}),(e=>{console.log(e)}),(()=>{const e=l.snapshot.ref._location.path_;getDownloadURL(l.snapshot.ref).then((o=>{newMusic({uid:uid,title:i,url:o,reference:e}).then((()=>{const e=a.find((e=>1==e.playing));getMusic(uid).then((a=>{const o=a.map((t=>e?.id==t.id?{...t,playing:!0}:{...t,playing:!1}));localStorage.setItem("music",JSON.stringify(o)),uploadTrackInput.value="",uploadTrack.removeAttribute("disabled"),t.classList.remove("active"),listMusic()}))}))}))}))},viewFolder=()=>{addNoteButton.classList.contains("active")||document.querySelector(".tab.creating")||(musicPlayer.classList.contains("active")&&viewMusic(),folder.classList.contains("active")?(document.querySelector(".files i").classList.replace("fa-folder-open","fa-folder"),volumeIndicator.classList.remove("menuOpen"),document.querySelector(".container1").classList.remove("menuOpen")):(document.querySelector(".files i").classList.replace("fa-folder","fa-folder-open"),volumeIndicator.classList.add("menuOpen"),document.querySelector(".container1").classList.add("menuOpen")),folder.classList.toggle("active"))},closeMenu=()=>{folder.classList.contains("active")&&(folder.classList.toggle("active"),document.querySelector(".files i").classList.replace("fa-folder-open","fa-folder"),volumeIndicator.classList.remove("menuOpen")),musicPlayer.classList.contains("active")&&(musicPlayer.classList.toggle("active"),volumeIndicator.classList.remove("menuOpen"),toggleFloating()),document.querySelector(".container1").classList.contains("menuOpen")&&document.querySelector(".container1").classList.remove("menuOpen")};if(noWelcome||welcomeContent)if(!noWelcome&&welcomeContent)textarea.value=welcomeContent,previewText(textarea.value);else{const e=JSON.parse(localStorage.getItem("openNotes"));if(!!e.length){const t=e.findIndex((e=>1==e.active)),a=e[t].title;changeTab(a)}}else fetch("../js/resources/welcomeText").then((e=>e.text())).then((e=>{textarea.value=e,previewText(textarea.value),localStorage.setItem("welcomeContent",e),welcomeContent=e}));const checkPreview=e=>{e==!rDocument.classList.contains("active")&&toggleView()},checkPreviewFirst=()=>{const e=JSON.parse(localStorage.getItem("previewFirst"))||!1;previewFirst.checked=!e,checkPreview(e)};checkPreviewFirst();const changePreviewFirst=()=>{const e=JSON.parse(localStorage.getItem("previewFirst"))||!1;localStorage.setItem("previewFirst",!e),checkPreviewFirst()},floatingPlayerState=()=>{const e=JSON.parse(localStorage.getItem("hiddenFloating"))||!1;showFloatingToggle.checked=!e};floatingPlayerState();const changeFloatingState=()=>{const e=JSON.parse(localStorage.getItem("hiddenFloating"))||!1;localStorage.setItem("hiddenFloating",!e),checkFloating()},floatingPlayerPosition=()=>{const e=localStorage.getItem("floatingPosition")||"br";floatingPosition.value=e};floatingPlayerPosition();const changeFloatingPosition=()=>{const e=floatingPosition.value;localStorage.setItem("floatingPosition",e),checkFloating()},checkFont=()=>{const e=localStorage.getItem("font")||(localStorage.setItem("font","Open Sans"),"Open Sans");fontOptions.forEach((t=>{t.textContent==e&&t.setAttribute("selected","")})),document.body.style.setProperty("--font",e)};checkFont();const changeFont=()=>{const e=fontSelect.options[fontSelect.selectedIndex].text;localStorage.setItem("font",e),checkFont()};class File{constructor(e,t){this.uid=e,this.title=t,this.content=""}}const createFile=e=>{const t=e.target.classList.value;let a;switch(t){case"inputButton":document.querySelector(".sidebar .add .newNote .input").classList.contains("error")&&document.querySelector(".sidebar .add .newNote .input").classList.remove("error"),a="button";break;case"noteTitle":document.querySelector(".folder .inputTitle .input").classList.contains("error")&&document.querySelector(".folder .inputTitle .input").classList.remove("error"),a="folder";break;case"inputTab":document.querySelector(".tabs .tab.creating .input").classList.contains("error")&&document.querySelector(".tabs .tab.creating .input").classList.remove("error"),a="tab"}if(13==e.keyCode){const o=e.target.value,c=JSON.parse(localStorage.getItem("notes"))||[],i=new File(uid,o);if(c.find((e=>e.title==o)))switch(t){case"inputButton":document.querySelector(".sidebar .add .newNote .input").classList.add("error");break;case"noteTitle":document.querySelector(".folder .inputTitle .input").classList.add("error");break;case"inputTab":document.querySelector(".tabs .tab.creating .input").classList.add("error")}else c.push(i),localStorage.setItem("notes",JSON.stringify(c)),closeInput(a),checkNotes(),addTab(o),checkTabs(),window.innerWidth<=700&&(closeMenu(),handleLeftSwipe()),e.preventDefault(),textarea.focus()}},newFolderNote=()=>{newNote.setAttribute("disabled",""),folder.classList.add("creating"),document.querySelector(".folder .list").insertAdjacentHTML("afterend",'<div class="inputTitle">\n            <i class="fas fa-note-sticky"></i>\n            <div class="input">\n                <input type="text" class="noteTitle">\n                <div class="close">\n                    <i class="fas fa-times"></i>\n                </div>\n            </div>\n        </div>'),document.querySelector(".folder .inputTitle input").focus();document.querySelector(".folder .inputTitle .close").addEventListener("click",(()=>closeInput("folder"))),document.querySelector(".folder .inputTitle input").addEventListener("keydown",createFile)},newButtonNote=()=>{closeMenu(),document.querySelector(".tab.creating")||(addNoteButton.classList.toggle("active"),setTimeout((()=>{addNoteSave.focus()}),200))},closeInput=e=>{switch(e){case"button":addNoteButton.classList.toggle("active"),addNoteSave.value="";break;case"folder":newNote.removeAttribute("disabled"),folder.classList.remove("creating"),document.querySelector(".folder .inputTitle").remove();break;case"tab":document.querySelector(".tab.creating").remove(),checkTabs()}},newTabNote=()=>{const e=document.querySelector(".container1 .tabs");addNoteButton.classList.contains("active")||document.querySelector(".tabs .tab.creating")||(e.insertAdjacentHTML("beforeend",'<div class="tab creating">\n            <div class="icon">\n                <i class="far fa-file"></i>\n            </div>\n            <div class="input">\n                <input type="text" class="inputTab" />\n                <div class="close">\n                    <i class="fas fa-times"></i>\n                </div>\n            </div>\n        </div>'),e.children.length?document.querySelector("header").classList.contains("noTabs")&&document.querySelector("header").classList.remove("noTabs"):document.querySelector("header").classList.add("noTabs"),document.querySelector(".tab.creating input").focus(),document.querySelector(".tab.creating input").addEventListener("keydown",createFile),document.querySelector(".tab.creating .close").addEventListener("click",(()=>closeInput("tab"))))},viewConfigOption=e=>{const t=configModal.querySelector(`.view.${e}`),a=configModal.querySelector(".view.active");t!=a&&(a.classList.remove("active"),t.classList.add("active"))};configOptions.forEach((e=>{const t=e.id;e.addEventListener("click",(()=>viewConfigOption(t)))}));const removeWelcome=()=>{localStorage.setItem("noWelcome",!0),localStorage.removeItem("welcomeContent"),noWelcome=!0,document.getElementById("40be4e59b9a2a2b5dffb918c0e86b3d7").remove(),previewText(""),textarea.value="";const e=JSON.parse(localStorage.getItem("openNotes"));if(!!e.length){const t=e.findIndex((e=>1==e.active)),a=e[t].title;changeTab(a)}checkTabs()},autoSave=()=>{if(document.querySelector(".tabs .welcomeTab.active")||!document.querySelector(".tabs .tab"))return;const e=document.querySelector(".tabs .tab.active").title,t=JSON.parse(localStorage.getItem("notes")),a=t.find((t=>t.title==e)),o=t.map((e=>e.title==a.title?{...e,content:textarea.value}:e));localStorage.setItem("notes",JSON.stringify(o))};autoSave();const handleRightSwipe=()=>{document.querySelector(".container1").classList.contains("activeRight")?(document.querySelector(".sidebar").removeAttribute("style"),document.querySelector(".container1").classList.remove("activeRight"),volumeIndicator.classList.remove("activeRight")):(document.querySelector(".container1").classList.add("activeLeft"),musicPlayer.classList.add("activeLeft"),setTimeout((()=>{document.querySelector(".sidebar").style.zIndex=26}),200))},handleLeftSwipe=()=>{document.querySelector(".container1").classList.contains("activeLeft")?(document.querySelector(".sidebar").removeAttribute("style"),document.querySelector(".container1").classList.remove("activeLeft"),musicPlayer.classList.remove("activeLeft")):(document.querySelector(".container1").classList.add("activeRight"),volumeIndicator.classList.add("activeRight"))};let touchStartX=0,touchEndX=0,touchStartY=0,touchEndY=0;const touchGestures=()=>{const e=touchStartX-touchEndX,t=touchStartY-touchEndY;Math.abs(e)>Math.abs(t)&&(touchEndX<touchStartX?handleLeftSwipe():document.querySelector(".container1").classList.contains("activeRight")?(document.querySelector(".sidebar").removeAttribute("style"),document.querySelector(".container1").classList.remove("activeRight"),volumeIndicator.classList.remove("activeRight")):(document.querySelector(".container1").classList.add("activeLeft"),musicPlayer.classList.add("activeLeft"),setTimeout((()=>{document.querySelector(".sidebar").style.zIndex=26}),200)))},setMobileHeight=()=>{window.innerWidth<=700?document.querySelector(".mainContainer").style.height=`${window.innerHeight}px`:document.querySelector(".mainContainer").hasAttribute("style")&&document.querySelector(".mainContainer").removeAttribute("style")};setMobileHeight();let discTouchX=0,discTouchY=0,discMoveX=0,discMoveY=0;const swipeVolume=()=>{const e=discTouchX-discMoveX,t=discTouchY-discMoveY;Math.abs(t)>Math.abs(e)&&(e=>{const t=document.querySelector("audio");t.volume=e?1!=t.volume?Math.round(100*(t.volume+.01))/100:1:0!=t.volume?Math.round(100*(t.volume-.01))/100:0,showVolume()})(discMoveY<discTouchY)};window.addEventListener("resize",setMobileHeight),document.addEventListener("keydown",saveDocument),toggleViewButton.addEventListener("click",toggleView),homeButton.addEventListener("click",(()=>location.href="../")),viewFiles.addEventListener("click",viewFolder),addNoteButton.addEventListener("click",newButtonNote),addNoteInput.addEventListener("click",(e=>e.stopPropagation())),addNoteSave.addEventListener("keydown",createFile),addNoteClose.addEventListener("click",(()=>closeInput("button"))),document.querySelector(".container1").addEventListener("click",closeMenu),textarea.addEventListener("input",(()=>{previewText(textarea.value),autoSave()})),newNote.addEventListener("click",newFolderNote),addNoteTab.addEventListener("click",newTabNote),addGuideNote.addEventListener("click",(()=>addNoteTab.click())),closeWelcome&&closeWelcome.addEventListener("click",removeWelcome),musicButton.addEventListener("click",viewMusic),playButton.addEventListener("click",togglePlay),playButton2.addEventListener("click",togglePlay),prevButton.addEventListener("click",prevSong),prevButton2.addEventListener("click",prevSong),nextButton.addEventListener("click",nextSong),nextButton2.addEventListener("click",nextSong),closeFloating.addEventListener("click",hideFloating),uploadTrack.addEventListener("click",(()=>uploadTrackInput.click())),uploadTrackInput.addEventListener("change",processTrack),document.querySelector("audio").addEventListener("ended",nextSong),disc.addEventListener("wheel",changeDiscVol),disc2.addEventListener("wheel",changeDiscVol),configButton.addEventListener("click",(()=>configContainer.classList.add("active"))),configContainer.addEventListener("click",(()=>configContainer.classList.remove("active"))),configModal.addEventListener("click",(e=>e.stopPropagation())),previewFirst.addEventListener("change",changePreviewFirst),showFloatingToggle.addEventListener("change",changeFloatingState),floatingPosition.addEventListener("change",changeFloatingPosition),fontSelect.addEventListener("change",changeFont),rDocument.addEventListener("touchstart",(e=>{touchStartX=e.changedTouches[0].screenX,touchStartY=e.changedTouches[0].screenY})),rDocument.addEventListener("touchend",(e=>{touchEndX=e.changedTouches[0].screenX,touchEndY=e.changedTouches[0].screenY,touchGestures()})),disc.addEventListener("touchstart",(e=>{discTouchX=e.changedTouches[0].screenX,discTouchY=e.changedTouches[0].screenY})),disc.addEventListener("touchmove",(e=>{e.preventDefault(),discMoveX=e.changedTouches[0].screenX,discMoveY=e.changedTouches[0].screenY,swipeVolume()}));
